#!/bin/bash

MAILDIR=~/Maildir
OPTS="--no-sync"
SALEARN=/usr/bin/vendor_perl/sa-learn

if [[ "$1" == "-q" ]]; then
    OPTS="$OPTS"
    OUTFILE="/dev/null"
else
    OPTS="$OPTS --showdots"
    OUTFILE="/dev/stdout"
fi

if [[ ! "$1" == "-q" ]]; then
    echo -n "$(date): Learning ham..."
fi
nice find $MAILDIR -type f | grep '/\(cur\|new\)/' | grep -v '/spam/' | xargs -P1 -n1000 $SALEARN $OPTS --ham > $OUTFILE

if [[ ! "$1" == "-q" ]]; then
    echo -n "$(date): Learning spam..."
fi
nice find $MAILDIR -type f | grep '/\(cur\|new\)/' | grep '/spam/' | xargs -P1 -n1000 $SALEARN $OPTS --spam > $OUTFILE

if [[ ! "$1" == "-q" ]]; then
    echo -n "$(date): Syncing..."
fi
nice $SALEARN --sync > $OUTFILE

if [[ ! "$1" == "-q" ]]; then
    echo -n "$(date): Done!"
fi
